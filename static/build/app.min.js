var wsRoomApp=angular.module("ws_room",["ngResource","ngRoute"]).constant("baseUrl","/api").config(["$routeProvider","$locationProvider",function(e,a){a.html5Mode(!0),e.when("/login",{templateUrl:"app/login-page/loginPage.html",controller:"loginCtrl"}).when("/games",{templateUrl:"app/games-list/gamesList.html",controller:"gamesListCtrl"}).when("/games/:id",{templateUrl:"app/game-board/gameBoard.html",controller:"gameBoardCtrl"}).otherwise({redirectTo:"/login"})}]);wsRoomApp.factory("Users",["$resource","baseUrl",function(e,a){return e(a+"/users/:id:controller",{},{login:{method:"POST",params:{controller:"login"}},logout:{method:"POST",params:{controller:"logout"}},loggedIn:{method:"GET",params:{controller:"logged-in"}}})}]),wsRoomApp.factory("Games",["$resource","baseUrl",function(e,a){return e(a+"/games/:controller/:id",{id:"@id"},{create:{method:"POST",params:{controller:"create"}},reset:{method:"GET",params:{controller:"reset"}},connect:{method:"GET",params:{controller:"connect"}}})}]),wsRoomApp.directive("navBar",function(){return{scope:!0,templateUrl:"app/common/navBar.html"}}),wsRoomApp.service("UserService",["Users",function(e){this.getLoggedIn=function(){return e.loggedIn().$promise.then(function(e){return e.id?e.toJSON():null})}}]),wsRoomApp.controller("mainCtrl",["$scope","$location","$rootScope","AuthService","UserService",function(e,a,o,s,t){o.globals={},o.$on("$locationChangeStart",function(e,s,n){t.getLoggedIn().then(function(e){o.globals.user=e;var s=-1===$.inArray(a.path(),["/login"]);!s||e?!s&&e&&a.path("/games"):a.path("/login")})}),o.$watch("globals.user",function(a){e.user=a}),e.logout=function(){s.logout()},o.$on("userUpdate",function(a,o){e.user=o})}]),wsRoomApp.factory("$socket",["$rootScope",function(e){var a=io.connect();return{on:function(o,s){a.on(o,function(){var o=arguments;e.$apply(function(){s.apply(a,o)})})},emit:function(o,s,t){a.emit(o,s,function(){var o=arguments;e.$apply(function(){t&&t.apply(a,o)})})}}}]),wsRoomApp.service("AuthService",["Users","$location","$rootScope",function(e,a,o){this.login=function(a,o){var s={username:a};e.login(s,function(e){o(e)})},this.logout=function(){e.logout(function(){o.globals={},a.path("/login")})}}]),wsRoomApp.controller("loginCtrl",["$scope","$location","$rootScope","AuthService",function(e,a,o,s){e.isFieldValid=function(a,o){var s=e.signInForm,t=s[a];return!s.$submitted||(o?!t.$error[o]:t.$valid)},e.login=function(t){e.signInForm.$invalid||(e.message=void 0,s.login(t.username,function(s){s.success?(o.globals.user=angular.copy(s.user),a.path("/games")):e.message=s.message}))}}]),wsRoomApp.controller("gamesListCtrl",["$scope","$socket","$location","Games",function(e,a,o,s){e.games=s.query(),e.waitingForOpponents=!1,e.newGameParams={size:"15"},a.on("games:createdNew",function(a){e.games.push(a)}),a.on("games:start",function(e){o.path("/games/"+e.gameId)}),e.createNewGame=function(){a.emit("games:create",e.newGameParams,function(){e.waitingForOpponents=!0})},e.connectToGame=function(o){a.emit("games:connect",o,function(a){e.message=a.message})}}]),wsRoomApp.directive("messageChat",function(){return{scope:{player:"=",chat:"="},replace:!0,templateUrl:"app/chat/chat.html",controller:["$scope","$socket","$routeParams","$element","$timeout",function(e,a,o,s,t){function n(a){e.text="",e.chat=angular.copy(a),t(function(){var e=s.find(".chat")[0];e.scrollTop=e.scrollHeight})}var l=o.id;e.isRival=function(a){return a.sender===e.player.username},e.sendMessage=function(o){if(e.text&&(!o||"Enter"===o.key)){var s={gameId:l,text:e.text};a.emit("chat:message",s,function(e){n(e)})}},a.on("chat:message",function(e){n(e)})}]}}),wsRoomApp.controller("gameBoardCtrl",["$scope","$socket","$location","$routeParams","Games","UserService",function(e,a,o,s,t,n){n.getLoggedIn().then(function(a){a.id&&(e.user=a)});var l=s.id;e.game=t.get({id:l},function(){e.game.id||o.path("/games"),e.size=e.game.size}),e.turn=function(o){var s={gameId:l,playerId:e.user.id,row:o.row,col:o.col};e.game.boardBlocked=!0,a.emit("games:turn",s,function(a){e.game.board=a.board})},a.on("games:turn",function(a){e.game.board=a.board,e.game.boardBlocked=!1})}]),angular.module("ws_room").run(["$templateCache",function(e){"use strict";e.put("app/chat/chat.html",'<div> <div class="chat-controls"> <div class="input-group well" id="typing-field"> <input type="text" ng-model="text" ng-keydown="sendMessage($event)" class="form-control" placeholder="Enter Your messege"/> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-click="sendMessage()">Send</button> </span> </div> </div> <div class="chat"> <div ng-repeat="container in chat" class="message-container" ng-class="{\'my-container\': isRival(container), \'rival-container\': !isRival(container)}"> <img ng-if="container.sender !== player.username" class="chat-avatar" src=""> <div ng-repeat="message in container.messages" class=""> <div class="message" ng-class="{\'my-message\': isRival(container), \'rival-message\': !isRival(container)}"> {{message.text}} </div> <time class="chat-time">{{message.time}}</time> </div> </div> </div> </div>'),e.put("app/common/navBar.html",'<nav class="navbar navbar-default" role="navigation"> <div class="container container-fluid"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#">Dots</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav"> <li class="active"><a href="#">Game board</a></li> </ul> <ul class="nav navbar-nav navbar-right"> <li ng-if="user" class="active"><a href="#">{{user.username}}</a></li> <li ng-if="user" class="active"><a href="" ng-click="logout()">Logout</a></li> <li ng-if="!user" class="active"><a href="/login">Login</a></li> </ul> </div> </div> </nav>'),e.put("app/game-board/gameBoard.html",'<div class="container"> <div class="row"> <div class="col-lg-7"> <div class="well"> <form class="form-inline"> <div class="form-group"> <label for="size">Size: </label> <select name="size" id="size" ng-model="size" class="form-control"> <option value="15">15 x 15</option> <option value="17">17 x 17</option> <option value="21">21 x 21</option> </select> </div> <button id="field-creator" class="btn btn-default" type="button">CREATE</button> <button id="reset-button" class="btn btn-default pull-right" type="button">RESET</button> </form> </div> </div> <div class="col-lg-5"> <div class="row"> <div class="col-lg-6"> <div class="panel panel-default"> <div class="panel-body"> <span>X-SCORE</span> </div> <div class="panel-footer"> <span id="x-score">0</span> </div> </div> </div> <div class="col-lg-6"> <div class="panel panel-default"> <div class="panel-body"> <span>O-SCORE</span> </div> <div class="panel-footer"> <span id="o-score">0</span> </div> </div> </div> </div> </div> </div> <div class="row"> <div class="col-lg-7"> <div id="game-field-container"> <table id="game-field"> <tr ng-repeat="rows in game.board"> <td ng-repeat="cell in rows" ng-click="turn(cell)"> {{cell.value}} </td> </tr> </table> </div> </div> <div class="col-lg-5"> \x3c!-- Nav tabs --\x3e <ul class="nav nav-tabs" role="tablist"> <li role="presentation" class="active"> <a href="#home" aria-controls="home" role="tab" data-toggle="tab">Chat</a> </li> <li role="presentation"> <a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">History</a> </li> <li role="presentation"> <a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Prefernces</a> </li> </ul> \x3c!-- Tab panes --\x3e <div class="tab-content g-tab-content"> <message-chat role="tabpanel" class="tab-pane active" player="user" chat="game.chat"></message-chat> <div role="tabpanel" class="tab-pane">...</div> <div role="tabpanel" class="tab-pane">...</div> </div> </div> </div> </div>'),e.put("app/games-list/gamesList.html",'<div ng-if="!waitingForOpponents" class="row"> <div class="col-md-8"> <table class="table table-striped"> <tr ng-repeat="game in games"> <td>{{game.id}}</td> <td>{{game.login}}</td> <td>{{game.locked ? \'LOCKED\' : \'AVAILABLE\'}}</td> <td> <span class="glyphicon glyphicon-plus" ng-click="connectToGame(game.id)"></span> </td> </tr> </table> </div> <div class="col-md-4"> <div ng-if="message" class="alert alert-danger col-sm-offset-2 col-sm-10" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> {{message}} </div> <ng-form name="newGameForm"> <div class="form-group"> <label for="password">Password</label> <input id="password" class="form-control" type="password" placeholder="Game password for private game" ng-model="newGameParams.password"> </div> <div class="form-group"> <label for="size">Size: </label> <select name="size" id="size" ng-model="newGameParams.size" class="form-control"> <option value="15">15 x 15</option> <option value="17">17 x 17</option> <option value="21">21 x 21</option> </select> </div> <div class="form-group"> <button type="submit" class="btn btn-default" ng-click="createNewGame()">Create game</button> </div> </ng-form> </div> </div> <div ng-if="waitingForOpponents" class="row"> <div class="col-md-12"> <h2>Waiting for opponents...</h2> </div> </div> '),e.put("app/login-page/loginPage.html",'<ng-form name="signInForm" class="form-horizontal md-form" autocomplete="off" novalidate> <div ng-if="message" class="alert alert-danger col-sm-12" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> {{message}} </div> <h1 class="form-title col-sm-offset-2 col-sm-10">Sign In</h1> <div class="form-group" ng-class="{\'has-error\': !isFieldValid(\'username\')}"> <label for="username" class="col-sm-2 control-label">Username</label> <div class="col-sm-10"> <input id="username" name="username" type="text" class="form-control form-control-danger" placeholder="Username" ng-model="user.username" minlength="2" maxlength="25" required> <span ng-if="!isFieldValid(\'username\', \'required\')" class="help-block">Username is required</span> <span ng-if="!isFieldValid(\'username\', \'minlength\')" class="help-block">Is too short</span> <span ng-if="!isFieldValid(\'username\', \'maxlength\')" class="help-block">Is too long</span> </div> </div> <div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button class="btn btn-success" ng-click="login(user)">Let\'s play</button> </div> </div> </ng-form>')}]);